# 第一周周记：获取多只股票股价

早些天在分析洋河股份的时候，想要对比白酒行业内排名前五家上市企业的股价/市盈率走势对比，
当前尽管可以从网络上获取每只股票的交易数据，也可以从券商或者提供金融服务的产品终端上获取
各自的走势信息，但它们都无法没有满足我的需求，于是想到了前段时间注册的聚宽。

由于目前在自学Python，在聚宽的研究环境上捣鼓两天之后发现获取信息非常方便，结合Python三
方库pandas的支持，能够很好地将获取到的数据图形化。

本周一看到`freemars`发布了《来聚宽的是不是大部分都是程序员？》有所感触，于是想到自己目前
正在学习，可以尝试把自己在聚宽上碰到的各种各样的问题记录下来，以周记的形式提供。希望有些
基础的知识点对于其他新人可以有一些帮助。但是，由于我当前侧重在企业价值分析，而非使用纯粹
的量化策略，所以笔记是否有用也不好说。

## 原版代码及解释

如下是自己写作的“获取一段时间多只股票走势图”的第一个代码版本，我将各个部分的代码注释在其
中：

```
# 第一句的import语句是Python里的基本语法，表示要使用pandas库，pandas可以方便进行数据处
# 理以及数据可视化——生成图形。
import pandas as pd

#############################################################################
# 一、获取股票名称对应的股票代码
#############################################################################

# 这里是我想要用来获取走势的企业名称，由于我们在使用聚宽提供的函数来获取数据时需要给定的
# 是股票的代码，但是股票代码我们一般记不住，所以有这一步将“股票名称”转换为“聚宽上对应的
# 股票代码”
stock_list = ['贵州茅台', '五粮液', '洋河股份', '泸州老窖', '古井贡酒']

# 聚宽提供了一个函数get_all_securities()用来获取聚宽平台支持的所有证券数据，包括各个股
# 票以及指数，可以查看“数据字典”了解它：https://www.joinquant.com/help/api/help?name=Stock#%E8%8E%B7%E5%8F%96%E8%82%A1%E7%A5%A8%E6%A6%82%E5%86%B5
#
# 函数返回的结果是DataFrame类型，这个类型是pandas里面定义的数据类型，它其实就是一个二维
# 表数据，里面包含了“股票名称”和“股票代码”，但是要从DataFrame里面获取想要的信息对于非程
# 序员来说需要提前了解两个知识点：
# 1. DataFrame的index和value获取方式
# 2. Python里面的list类型，以及for循环
stocks_df = get_all_securities()
stock_code_list = [stocks_df[stocks_df['display_name'] == stock].index.item() for stock in stock_list]

#############################################################################
# 二、获取财务数据中的市值数据（valuation），其中包含有 pe_ratio
#############################################################################

# 获取某股票的股价需要使用聚宽平台提供的函数get_price()，这个函数需要支持一些参数，比如
# 时间、频率、股价类型等等，可以参考：https://www.joinquant.com/help/api/help?name=Stock#%E8%B4%A2%E5%8A%A1%E6%95%B0%E6%8D%AE%E5%88%97%E8%A1%A8
# 下面代码的逻辑是调用`get_price()`逐个获取多只股票的走势数据，并将其保存下来。之所以使
# 用字典是因为它可以比较方便地用来创建DataFrame，并且index可以设定为对应的股票名称。
start_date = '2018-12-05'
end_date = '2019-12-05'
multi_stock_price = {}
for i in range(len(stock_list)):
    stock_code = stock_code_list[i]
    stock_name = stock_list[i]
    stock_price = get_price(stock_code, start_date, end_date, 'daily', 'close')
    multi_stock_price[stock_name] = stock_price['close']

df = pd.DataFrame(multi_stock_price)
df.plot(figsize = (20, 10))
```

## 更新的版本

1. 略过非交易日
2. 如何接近非Panel的问题

# 知识点详解

## 聚宽提供的服务函数

## Pandas视图

## isin
